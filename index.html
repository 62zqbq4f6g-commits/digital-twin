<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#000000">
  <meta name="description" content="Digital Twin - AI-powered second brain for voice and text notes">

  <title>Digital Twin</title>

  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">

  <!-- Icons -->
  <link rel="icon" type="image/png" sizes="192x192" href="assets/icon-192.png">
  <link rel="apple-touch-icon" href="assets/icon-192.png">

  <!-- Styles -->
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <div id="app">
    <!-- Header -->
    <header class="header">
      <h1 class="header-title">Digital Twin</h1>
    </header>

    <!-- Main Content -->
    <main class="main">
      <!-- Capture Screen -->
      <section id="screen-capture" class="screen">
        <!-- Capture Section (default view) -->
        <div id="capture-section">
          <!-- Voice button area -->
          <div class="capture-voice-area">
            <button id="voice-btn" class="voice-btn" aria-label="Start voice recording">
              <span class="voice-icon">üé§</span>
            </button>
            <p class="voice-hint">Tap to speak</p>
            <p id="transcript-display" class="transcript-display"></p>
          </div>

          <!-- Text input area -->
          <div class="capture-input-area">
            <div class="text-input-container">
              <textarea
                id="text-input"
                class="text-input"
                placeholder="What's on your mind?"
                rows="1"
              ></textarea>
              <button id="submit-btn" class="submit-btn" aria-label="Submit note">
                <span class="submit-icon">‚Üí</span>
              </button>
            </div>

            <!-- Image Input (hidden file input) -->
            <input type="file" id="image-input" accept="image/*" capture="environment" class="hidden">

            <!-- Add Image Button -->
            <button id="image-btn" class="image-add-btn">
              <span class="image-icon">üì∑</span>
              <span>Add Image</span>
            </button>
          </div>
        </div>

        <!-- Image Section (shown after image selected) -->
        <section id="image-section" class="hidden">
          <div class="image-preview-container">
            <img id="image-preview" alt="Preview">
            <button id="remove-image" class="remove-image-btn" aria-label="Remove image">‚úï</button>
          </div>

          <!-- Context input with voice option -->
          <div class="image-context-area">
            <div class="image-context-header">
              <span class="image-context-label">Add context (optional)</span>
            </div>
            <div class="image-context-input-row">
              <button id="image-voice-btn" class="image-voice-btn" aria-label="Add context via voice">
                <span>üé§</span>
              </button>
              <textarea
                id="image-context"
                class="image-context-input"
                placeholder="Type or tap mic to speak..."
                rows="2"
              ></textarea>
            </div>
            <p id="image-transcript-display" class="image-transcript-display"></p>
          </div>

          <button id="process-image-btn" class="btn-primary btn-full">
            Process Image
          </button>
        </section>
      </section>

      <!-- Notes Screen -->
      <section id="screen-notes" class="screen hidden">
        <!-- Search Box -->
        <div class="notes-search">
          <input
            type="text"
            id="notes-search-input"
            class="notes-search-input"
            placeholder="Search notes..."
          >
        </div>

        <!-- Filter Tabs -->
        <div class="notes-filters">
          <button class="filter-tab active" data-category="all">All</button>
          <button class="filter-tab" data-category="work">üíº Work</button>
          <button class="filter-tab" data-category="personal">üè† Personal</button>
          <button class="filter-tab" data-category="health">üí™ Health</button>
          <button class="filter-tab" data-category="ideas">üí° Ideas</button>
        </div>

        <!-- Notes List -->
        <div id="notes-list" class="notes-list">
          <!-- Notes will be dynamically inserted here -->
        </div>

        <!-- Empty State -->
        <div id="notes-empty" class="notes-empty hidden">
          <p class="notes-empty-text">No notes yet. Tap Capture to add your first note.</p>
        </div>
      </section>

      <!-- Settings Screen -->
      <section id="screen-settings" class="screen hidden">
        <div class="settings-section">
          <h2 class="settings-heading">Insights</h2>
          <button id="digest-btn" class="digest-trigger-btn" onclick="Digest.generate()">
            <span>Weekly Digest</span>
          </button>
        </div>

        <div class="settings-section">
          <h2 class="settings-heading">Data</h2>
          <button id="export-all-btn" class="settings-btn">
            <span>Export All Notes</span>
            <span class="settings-btn-desc">Download backup as JSON file</span>
          </button>
        </div>

        <div class="settings-section">
          <h2 class="settings-heading">Danger Zone</h2>
          <button id="clear-data-btn" class="settings-btn settings-btn-danger">
            <span>Clear All Data</span>
            <span class="settings-btn-desc">Delete all notes permanently</span>
          </button>
        </div>

        <div class="settings-section settings-version">
          <p class="settings-version-text">Digital Twin v<span id="app-version">2.0.2</span></p>
        </div>
      </section>

      <!-- Note Detail Screen (overlay) -->
      <section id="screen-note-detail" class="screen note-detail-screen hidden">
        <!-- Header with back button -->
        <div class="note-detail-header">
          <button id="note-detail-back" class="note-detail-back" aria-label="Back to notes">
            <span>‚Üê</span>
          </button>
          <div class="note-detail-category">
            <span id="note-detail-icon"></span>
            <span id="note-detail-category-label"></span>
          </div>
        </div>

        <!-- Note content -->
        <div class="note-detail-content">
          <h2 id="note-detail-title" class="note-detail-title"></h2>
          <p id="note-detail-timestamp" class="note-detail-timestamp"></p>
          <div id="note-detail-body" class="note-detail-body"></div>
        </div>

        <!-- Action buttons -->
        <div class="note-detail-actions">
          <button id="note-detail-copy" class="note-detail-btn">
            <span>Copy</span>
          </button>
          <button id="note-detail-export" class="note-detail-btn">
            <span>Export JSON</span>
          </button>
          <button id="note-detail-delete" class="note-detail-btn note-detail-btn-danger">
            <span>Delete</span>
          </button>
        </div>
      </section>
    </main>

    <!-- Delete Confirmation Dialog -->
    <div id="delete-dialog" class="dialog-overlay hidden">
      <div class="dialog">
        <h3 class="dialog-title">Delete Note?</h3>
        <p class="dialog-message">This action cannot be undone.</p>
        <div class="dialog-actions">
          <button id="delete-cancel" class="dialog-btn">Cancel</button>
          <button id="delete-confirm" class="dialog-btn dialog-btn-danger">Delete</button>
        </div>
      </div>
    </div>

    <!-- Clear All Data Dialog -->
    <div id="clear-data-dialog" class="dialog-overlay hidden">
      <div class="dialog">
        <h3 class="dialog-title">Clear All Data?</h3>
        <p class="dialog-message">This will permanently delete all your notes. This action cannot be undone.</p>
        <div class="dialog-actions">
          <button id="clear-data-cancel" class="dialog-btn">Cancel</button>
          <button id="clear-data-confirm" class="dialog-btn dialog-btn-danger">Clear All</button>
        </div>
      </div>
    </div>

    <!-- Digest Modal -->
    <div id="digest-modal" class="modal hidden">
      <div class="modal-content">
        <button class="modal-close" onclick="Digest.closeDigest()">‚úï</button>
        <div id="digest-content">
          <!-- Populated by JS -->
        </div>
      </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="nav">
      <button class="nav-tab active" data-screen="capture">
        <span class="nav-icon">‚óè</span>
        <span class="nav-label">Capture</span>
      </button>
      <button class="nav-tab" data-screen="notes">
        <span class="nav-icon">‚ò∞</span>
        <span class="nav-label">Notes</span>
      </button>
      <button class="nav-tab" data-screen="settings">
        <span class="nav-icon">‚öô</span>
        <span class="nav-label">Settings</span>
      </button>
    </nav>
  </div>

  <!-- Scripts -->
  <script src="js/db.js"></script>
  <script src="js/classifier.js"></script>
  <script src="js/extractor.js"></script>
  <script src="js/refiner.js"></script>
  <script src="js/app.js"></script>
  <script src="js/ui.js"></script>
  <script src="js/voice.js"></script>
  <script src="js/camera.js"></script>
  <script src="js/digest.js"></script>
  <script>
    // Register Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js')
          .then(registration => {
            console.log('ServiceWorker registered:', registration.scope);
          })
          .catch(error => {
            console.log('ServiceWorker registration failed:', error);
          });
      });
    }

    // Initialize app
    document.addEventListener('DOMContentLoaded', async () => {
      await App.init();
      UI.init();
      Voice.init();
      Camera.init();
    });
  </script>
</body>
</html>
