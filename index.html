<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#000000">
  <meta name="description" content="Inscript ‚Äî The first AI that actually remembers you. Not just your notes ‚Äî your world.">
  <meta name="application-name" content="Inscript">
  <meta property="og:title" content="Inscript ‚Äî Your mirror in code">
  <meta property="og:description" content="The first AI that actually remembers you.">

  <title>Inscript ‚Äî Your mirror in code</title>

  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">

  <!-- Icons -->
  <link rel="icon" type="image/png" sizes="192x192" href="assets/icon-192.png">
  <link rel="apple-touch-icon" href="assets/icon-192.png">

  <!-- Google Fonts - Vogue Aesthetic -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://hpvspuqszallvwfsvdjt.supabase.co" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400&family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400&family=Playfair+Display:wght@400;500;600&display=swap" rel="stylesheet">

  <!-- Inline Skeleton Styles (renders before JS executes) -->
  <style id="skeleton-styles">
    .app-skeleton {
      position: fixed;
      inset: 0;
      background: #FFFFFF;
      z-index: 9999;
      display: flex;
      flex-direction: column;
    }
    .app-skeleton.hidden {
      opacity: 0;
      pointer-events: none;
      transition: opacity 300ms ease-out;
    }
    .skeleton-header {
      height: 64px;
      display: flex;
      align-items: center;
      padding: 0 24px;
      border-bottom: 1px solid rgba(0,0,0,0.06);
    }
    .skeleton-logo {
      font-family: 'Inter', -apple-system, sans-serif;
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.2em;
      color: #1A1A1A;
      text-transform: uppercase;
    }
    .skeleton-content {
      flex: 1;
      padding: 24px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-width: 600px;
      margin: 0 auto;
      width: 100%;
    }
    .skeleton-card {
      height: 120px;
      background: linear-gradient(90deg, #F5F5F5 25%, #EEEEEE 50%, #F5F5F5 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s linear infinite;
      border: 1px solid rgba(0,0,0,0.06);
      border-radius: 12px;
    }
    .skeleton-nav {
      height: 72px;
      display: flex;
      justify-content: space-around;
      align-items: center;
      border-top: 1px solid rgba(0,0,0,0.06);
      padding: 0 48px;
    }
    .skeleton-nav-item {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      background: linear-gradient(90deg, #F5F5F5 25%, #EEEEEE 50%, #F5F5F5 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s linear infinite;
    }
    @keyframes shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
  </style>

  <!-- Styles -->
  <link rel="stylesheet" href="css/styles.css?v=911">
  <link rel="stylesheet" href="css/design-system.css?v=804">
  <link rel="stylesheet" href="css/mirror.css?v=800">
  <link rel="stylesheet" href="css/patterns.css?v=800">
  <!-- PHASE 15 - T2 -->
  <link rel="stylesheet" href="css/state-of-you.css?v=850">
  <link rel="stylesheet" href="css/whisper.css?v=850">
  <link rel="stylesheet" href="css/memory-moments.css?v=850">
  <!-- PHASE 16 - T1 -->
  <link rel="stylesheet" href="css/enhancement.css?v=860">
  <!-- YOU Tab Refinement - Design System v2 -->
  <link rel="stylesheet" href="css/you-tab-refined.css?v=950">
  <!-- EXPORT - T3 -->
  <link rel="stylesheet" href="css/settings-export.css?v=922">
  <!-- PRIVACY - T3 Sprint 2 -->
  <link rel="stylesheet" href="css/privacy-controls.css?v=100">
</head>
<body>
  <!-- App Skeleton (shows instantly before JS loads) -->
  <div id="app-skeleton" class="app-skeleton">
    <div class="skeleton-header">
      <span class="skeleton-logo">Inscript</span>
    </div>
    <div class="skeleton-content">
      <div class="skeleton-card"></div>
      <div class="skeleton-card"></div>
      <div class="skeleton-card"></div>
    </div>
    <div class="skeleton-nav">
      <div class="skeleton-nav-item"></div>
      <div class="skeleton-nav-item"></div>
      <div class="skeleton-nav-item"></div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div id="loading-overlay" class="loading-overlay">
    <div class="loading-content">
      <div class="loading-icon">
        <svg class="loading-spinner" viewBox="0 0 50 50">
          <circle cx="25" cy="25" r="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </div>
      <p class="loading-text" id="loading-text">sitting with this...</p>
    </div>
  </div>

  <!-- Auth Screen (shown before app) -->
  <div id="auth-screen" class="auth-container hidden">
    <div class="auth-card">
      <!-- Brand -->
      <div class="auth-brand">
        <h1 class="auth-logo">INSCRIPT</h1>
        <p class="auth-tagline">Your mirror in code</p>
      </div>

      <!-- Sign In Form (default) -->
      <div id="auth-signin-form" class="auth-form-wrapper">
        <form class="auth-form" onsubmit="return false;">
          <div class="auth-field">
            <label class="auth-label" for="auth-signin-email">Email</label>
            <input type="email" id="auth-signin-email" class="auth-input" placeholder="you@example.com" autocomplete="email">
          </div>

          <div class="auth-field">
            <label class="auth-label" for="auth-signin-password">Password</label>
            <input type="password" id="auth-signin-password" class="auth-input" placeholder="Enter password" autocomplete="current-password">
          </div>

          <p id="auth-signin-error" class="auth-error hidden"></p>

          <button type="submit" id="auth-signin-btn" class="auth-btn">Sign in</button>
        </form>

        <p class="auth-footer">
          New here? <button id="show-signup-btn" class="auth-link">Create account</button>
        </p>
      </div>

      <!-- Sign Up Form -->
      <div id="auth-signup-form" class="auth-form-wrapper hidden">
        <form class="auth-form" onsubmit="return false;">
          <div class="auth-field">
            <label class="auth-label" for="auth-signup-email">Email</label>
            <input type="email" id="auth-signup-email" class="auth-input" placeholder="you@example.com" autocomplete="email">
          </div>

          <div class="auth-field">
            <label class="auth-label" for="auth-signup-password">Password</label>
            <input type="password" id="auth-signup-password" class="auth-input" placeholder="Min 6 characters" autocomplete="new-password">
          </div>

          <p id="auth-signup-error" class="auth-error hidden"></p>

          <button type="submit" id="auth-signup-btn" class="auth-btn">Begin</button>
        </form>

        <p class="auth-footer">
          Have an account? <button id="show-signin-btn" class="auth-link">Sign in</button>
        </p>
      </div>
    </div>
  </div>

  <!-- Main App Container -->
  <div id="app">
    <!-- Header -->
    <header class="header">
      <h1 class="header-title brand-logo">INSCRIPT</h1>
      <span id="sync-indicator" class="sync-indicator"></span>
      <div class="header-buttons">
        <button class="header-settings-btn" id="header-settings-btn" aria-label="Settings">
          <span>‚öô</span>
        </button>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main">
      <!-- Capture Screen - Phase 4C: Now a sub-screen for image capture -->
      <section id="screen-capture" class="screen hidden">
        <!-- Back button to return to notes -->
        <button id="capture-back-btn" class="capture-back-btn" aria-label="Back to notes">
          <span>‚Üê Back</span>
        </button>
        <!-- Capture Section (default view) -->
        <div id="capture-section">
          <!-- Voice button area -->
          <div class="capture-voice-area">
            <button id="voice-btn" class="voice-btn" aria-label="Start voice recording">
              <span class="voice-icon mic-icon">üé§</span>
              <div class="stop-icon"></div>
            </button>
            <p class="voice-hint">Tap to speak</p>
            <p id="transcript-display" class="transcript-display"></p>
          </div>

          <!-- Text input area -->
          <div class="capture-input-area">
            <div class="text-input-container">
              <label for="text-input" class="sr-only">Note content</label>
              <textarea
                id="text-input"
                class="text-input"
                placeholder="What's on your mind?"
                rows="1"
                autocomplete="off"
                autocorrect="off"
                autocapitalize="off"
                spellcheck="false"
                data-lpignore="true"
                data-form-type="other"
              ></textarea>
              <button id="submit-btn" class="submit-btn" aria-label="Submit note">
                <span class="submit-icon">‚Üí</span>
              </button>
            </div>

            <!-- Image Input (hidden file input) -->
            <label for="image-input" class="sr-only">Upload image</label>
            <input type="file" id="image-input" accept="image/*" class="hidden">

            <!-- Add Media Button -->
            <button id="image-btn" class="image-add-btn">
              <span class="image-icon">üì∑</span>
              <span>Add Media</span>
            </button>

            <!-- Start Listening Button (Ambient Recording) -->
            <button id="ambient-btn" class="ambient-add-btn" aria-label="Start ambient listening">
              <span class="ambient-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <circle cx="12" cy="12" r="10"/>
                  <circle cx="12" cy="12" r="3"/>
                  <path d="M12 2v3M12 19v3M2 12h3M19 12h3"/>
                </svg>
              </span>
              <span>Start Listening</span>
            </button>
          </div>
        </div>

        <!-- Image Section (shown after image selected) -->
        <section id="image-section" class="hidden">
          <div class="image-preview-container">
            <img id="image-preview" alt="Preview">
            <button id="remove-image" class="remove-image-btn" aria-label="Remove image">‚úï</button>
          </div>

          <!-- Context input with voice option -->
          <div class="image-context-area">
            <div class="image-context-header">
              <label class="image-context-label" for="image-context">Add context (optional)</label>
            </div>
            <div class="image-context-input-row">
              <button id="image-voice-btn" class="image-voice-btn" aria-label="Add context via voice">
                <span class="mic-icon">üé§</span>
                <div class="stop-icon"></div>
              </button>
              <textarea
                id="image-context"
                class="image-context-input"
                placeholder="Type or tap mic to speak..."
                rows="2"
              ></textarea>
            </div>
            <p id="image-transcript-display" class="image-transcript-display"></p>
          </div>

          <button id="process-image-btn" class="btn-primary btn-full">
            Process Image
          </button>
        </section>
      </section>

      <!-- Notes Screen - Phase 4C: Now includes capture -->
      <section id="screen-notes" class="screen">
        <!-- Quick Capture Input (integrated into Notes) -->
        <div class="notes-capture-area">
          <div id="notes-image-preview" class="notes-image-preview"></div>
          <div class="notes-capture-row">
            <button id="notes-voice-btn" class="notes-voice-btn" aria-label="Voice input">
              <span class="mic-icon">üé§</span>
              <div class="stop-icon"></div>
            </button>
            <label for="notes-quick-input" class="sr-only">Quick note</label>
            <input
              type="text"
              id="notes-quick-input"
              class="notes-quick-input"
              placeholder="What's on your mind?"
            >
            <button id="notes-camera-btn" class="notes-camera-btn" aria-label="Add image">
              <span>üì∑</span>
            </button>
            <button id="notes-submit-btn" class="notes-submit-btn" aria-label="Submit">
              <span>‚Üí</span>
            </button>
          </div>
          <p id="notes-transcript-display" class="notes-transcript-display"></p>
          <!-- Quick Modes (Phase 14) -->
          <div class="notes-quick-modes">
            <button id="meeting-mode-btn" class="quick-mode-btn" aria-label="Meeting mode">
              <span class="quick-mode-label">Meeting</span>
            </button>
            <button id="decision-mode-btn" class="quick-mode-btn" aria-label="Decision mode">
              <span class="quick-mode-label">Decision</span>
            </button>
            <!-- PHASE 15 - T2 -->
            <button id="whisper-mode-btn" class="quick-mode-btn whisper-trigger" aria-label="Whisper mode">
              <span class="quick-mode-label">Whisper</span>
            </button>
          </div>
        </div>

        <!-- Search Box -->
        <div class="notes-search">
          <label for="notes-search-input" class="sr-only">Search notes</label>
          <input
            type="text"
            id="notes-search-input"
            class="notes-search-input"
            placeholder="Search notes..."
            autocomplete="off"
          >
        </div>

        <!-- Filter Tabs -->
        <div class="notes-filters">
          <button class="filter-tab active" data-category="all">All</button>
          <button class="filter-tab" data-category="work">Work</button>
          <button class="filter-tab" data-category="personal">Personal</button>
          <button class="filter-tab" data-category="ideas">Ideas</button>
        </div>

        <!-- Notes List -->
        <div id="notes-list" class="notes-list">
          <!-- Notes will be dynamically inserted here -->
        </div>

        <!-- Empty State -->
        <div id="notes-empty" class="notes-empty hidden">
          <p class="notes-empty-text">No notes yet. Start capturing your thoughts above.</p>
        </div>
      </section>

      <!-- Twin Screen - REMOVED in Phase 15.1 (merged into YOU tab) -->

      <!-- MIRROR Screen - Phase 13B -->
      <section id="screen-mirror" class="screen hidden">
        <div id="mirror-container" class="mirror-container">
          <!-- Populated by Mirror.js -->
        </div>
      </section>

      <!-- YOU Screen (Phase 15.1 - 3-Tab Restructure) -->
      <section id="screen-you" class="screen hidden">
        <!-- Sub-tab Navigation -->
        <div class="you-tabs">
          <button class="you-tab active" data-you-tab="stream">STREAM</button>
          <button class="you-tab" data-you-tab="meetings">MEETINGS</button>
          <button class="you-tab" data-you-tab="patterns">PATTERNS</button>
          <button class="you-tab" data-you-tab="stats">STATS</button>
        </div>

        <!-- STREAM Sub-tab (Actions + Whispers) -->
        <div id="you-stream" class="you-content">
          <!-- Actions Section (prioritized) -->
          <div class="you-section">
            <h3 class="you-section-title">Actions</h3>
            <div class="actions-list" id="actions-list">
              <!-- Populated by JS -->
            </div>
            <div class="actions-empty hidden" id="actions-empty">
              <p class="you-empty">No actions captured yet.</p>
            </div>
          </div>

          <!-- Whisper History Section -->
          <div class="you-section">
            <h3 class="you-section-title">Whispers</h3>
            <div id="you-whisper-list" class="you-whisper-list">
              <p class="you-empty">No whispers yet. Use the Whisper button in NOTES to capture quick thoughts.</p>
            </div>
          </div>
        </div>

        <!-- MEETINGS Sub-tab -->
        <div id="you-meetings" class="you-content hidden">
          <!-- MeetingsTab renders here -->
        </div>

        <!-- PATTERNS Sub-tab (includes State of You report) -->
        <div id="you-patterns" class="you-content hidden">
          <div class="you-section">
            <h3 class="you-section-title">Patterns I've Noticed</h3>
            <div id="you-patterns-container">
              <p class="you-empty">No patterns detected yet. Keep writing to reveal your rhythms.</p>
            </div>
          </div>

          <!-- Weekly Digest (moved from Settings) -->
          <div class="you-section">
            <h3 class="you-section-title">Weekly Digest</h3>
            <div id="you-digest-container">
              <button id="digest-btn" class="digest-trigger-btn" onclick="Digest.generate()">
                <span>Generate This Week's Digest</span>
              </button>
            </div>
          </div>

          <!-- State of You Report (moved from REPORT tab) -->
          <div class="you-section">
            <h3 class="you-section-title">State of You</h3>
            <div id="you-report-container">
              <p class="you-empty">Your monthly reflection will appear here at the start of each month.</p>
            </div>
          </div>
        </div>

        <!-- STATS Sub-tab -->
        <div id="you-stats" class="you-content hidden">
          <!-- About You Section (onboarding data + edit) -->
          <div id="about-me-section" class="you-section">
            <!-- Populated by UIProfile.renderAboutYouSection() -->
          </div>

          <!-- Your Preferences Section (unlocks after 5 notes) -->
          <div id="preferences-section" class="you-section">
            <!-- Populated by UIProfile.renderPreferencesSection() -->
          </div>

          <!-- Your World Section (entities/people noted by app) -->
          <div id="your-world-section" class="you-section">
            <!-- Populated by Entities.renderYourWorldSection() -->
          </div>

          <!-- What I've Learned Section -->
          <div class="learning-section-container you-section" id="learning-section">
            <!-- Populated by TwinUI.renderLearningSection() -->
          </div>

          <!-- Notification Preferences Section (Phase 17) -->
          <div id="notification-prefs-section" class="you-section">
            <!-- Populated by UIProfile.renderNotificationPrefsSection() -->
          </div>

          <!-- Stats Grid -->
          <div class="twin-stats">
            <div class="twin-stat">
              <span class="twin-stat-value" id="twin-stat-notes">0</span>
              <span class="twin-stat-label">Notes</span>
            </div>
            <div class="twin-stat">
              <span class="twin-stat-value" id="twin-stat-decisions">0</span>
              <span class="twin-stat-label">Decisions</span>
            </div>
            <div class="twin-stat">
              <span class="twin-stat-value" id="twin-stat-patterns">0</span>
              <span class="twin-stat-label">Patterns</span>
            </div>
            <div class="twin-stat">
              <span class="twin-stat-value" id="twin-stat-feedback">0%</span>
              <span class="twin-stat-label">Positive</span>
            </div>
          </div>

          <!-- Confidence Meter -->
          <div class="twin-confidence">
            <div class="twin-confidence-header">
              <span class="twin-confidence-label">How well I know you</span>
              <span class="twin-confidence-value" id="twin-confidence-value">0%</span>
            </div>
            <div class="twin-confidence-bar">
              <div class="twin-confidence-fill" id="twin-confidence-fill" style="width: 0%"></div>
            </div>
            <p class="twin-confidence-hint" id="twin-confidence-hint">Your digital twin is beginning to mirror your nuances.</p>
          </div>

          <!-- Quality Learning Stats -->
          <div class="quality-section" id="quality-stats-section">
            <div class="quality-card">
              <div class="quality-header">
                <span class="quality-title">Output Quality</span>
                <span class="quality-trend" id="quality-trend">‚Äî</span>
              </div>
              <div class="quality-bar-container">
                <div class="quality-bar" id="quality-bar" style="width: 0%"></div>
              </div>
              <div class="quality-stats-row">
                <span id="quality-liked">0 liked</span>
                <span id="quality-disliked">0 disliked</span>
              </div>
            </div>
            <div class="quality-preferences" id="quality-preferences">
              <!-- Filled by JS -->
            </div>
          </div>

          <!-- Editorial Footer -->
          <p class="twin-footer">Listening to your silence between the lines.</p>
        </div>
      </section>

      <!-- Settings Screen -->
      <section id="screen-settings" class="screen hidden">
        <!-- Account Section -->
        <div class="settings-section">
          <h2 class="settings-heading">Account</h2>
          <div class="settings-account-card" id="account-card">
            <div class="account-info">
              <span class="account-email" id="account-email">Not signed in</span>
              <span class="sync-status" id="sync-status">‚óã Offline</span>
            </div>
            <button class="account-sync-btn" id="sync-now-btn" onclick="Sync.syncNow()">‚Üª</button>
          </div>
          <div class="settings-auth-buttons" id="auth-buttons">
            <button class="settings-btn settings-btn-outline" id="sign-in-btn">
              <span>Sign In</span>
            </button>
            <p class="settings-auth-link">
              Don't have an account? <button id="sign-up-link" class="settings-link-btn">Sign Up</button>
            </p>
          </div>
        </div>

        <!-- Encryption Trust Signal -->
        <div class="settings-section encryption-status">
          <p class="encryption-statement">Your thoughts are encrypted.</p>
          <p class="encryption-subtext">Only you hold the key.</p>
          <div class="encryption-spec">AES-256-GCM ¬∑ Zero-knowledge</div>
        </div>

        <div class="settings-section">
          <h2 class="settings-heading">Data</h2>
          <button id="export-all-btn" class="settings-btn">
            <span>Export All Notes</span>
            <span class="settings-btn-desc">Download backup as JSON file</span>
          </button>
        </div>

        <div class="settings-section settings-danger-zone">
          <h2 class="settings-heading">Danger Zone</h2>
          <button id="clear-data-btn" class="settings-btn settings-btn-danger">
            <span>Delete All Data</span>
            <span class="settings-btn-desc">Permanently deletes all notes, actions, and settings (including cloud)</span>
          </button>
          <button id="sign-out-btn" class="settings-btn settings-btn-danger hidden">
            <span>Sign Out</span>
            <span class="settings-btn-desc">Sign out of cloud sync</span>
          </button>
        </div>

        <div class="settings-section settings-version">
          <p class="settings-version-text">Inscript v<span id="app-version">9.1.0</span></p>
        </div>
      </section>

      <!-- Note Detail Screen (overlay) -->
      <section id="screen-note-detail" class="screen note-detail-screen hidden">
        <!-- Header with back button -->
        <div class="note-detail-header">
          <button id="note-detail-back" class="note-detail-back" aria-label="Back to notes">
            <span>‚Üê</span>
          </button>
          <div class="note-detail-category">
            <span id="note-detail-icon"></span>
            <span id="note-detail-category-label"></span>
          </div>
        </div>

        <!-- Note content -->
        <div class="note-detail-content">
          <h2 id="note-detail-title" class="note-detail-title"></h2>
          <p id="note-detail-timestamp" class="note-detail-timestamp"></p>
          <div id="note-detail-body" class="note-detail-body"></div>
        </div>

        <!-- Action buttons -->
        <div class="note-detail-actions">
          <button id="note-detail-copy" class="note-detail-btn">
            <span>Copy</span>
          </button>
          <button id="note-detail-export" class="note-detail-btn">
            <span>Export JSON</span>
          </button>
          <button id="note-detail-delete" class="note-detail-btn note-detail-btn-danger">
            <span>Delete</span>
          </button>
        </div>
      </section>
    </main>

    <!-- Delete Confirmation Dialog -->
    <div id="delete-dialog" class="dialog-overlay hidden">
      <div class="dialog">
        <h3 class="dialog-title">Delete Note?</h3>
        <p class="dialog-message">This action cannot be undone.</p>
        <div class="dialog-actions">
          <button id="delete-cancel" class="dialog-btn">Cancel</button>
          <button id="delete-confirm" class="dialog-btn dialog-btn-danger">Delete</button>
        </div>
      </div>
    </div>

    <!-- Clear All Data Dialog -->
    <div id="clear-data-dialog" class="dialog-overlay hidden">
      <div class="dialog">
        <h3 class="dialog-title">Clear All Data?</h3>
        <p class="dialog-message">This will permanently delete all your notes. This action cannot be undone.</p>
        <div class="dialog-actions">
          <button id="clear-data-cancel" class="dialog-btn">Cancel</button>
          <button id="clear-data-confirm" class="dialog-btn dialog-btn-danger">Clear All</button>
        </div>
      </div>
    </div>

    <!-- Auth Modal - Vogue Minimalist -->
    <div id="auth-modal" class="auth-modal hidden">
      <div class="auth-container">
        <!-- Header -->
        <div class="auth-header">
          <span class="auth-brand brand-logo">Inscript</span>
        </div>

        <!-- Close button -->
        <button id="auth-close" class="auth-close" aria-label="Close">‚úï</button>

        <!-- Sign In Form (default) -->
        <div id="auth-signin" class="auth-form">
          <div class="auth-fields">
            <div class="auth-field">
              <label class="auth-label" for="signin-email">Email</label>
              <input type="email" id="signin-email" class="auth-input" placeholder="your@email.com" autocomplete="email">
            </div>
            <div class="auth-field">
              <label class="auth-label" for="signin-password">Password</label>
              <input type="password" id="signin-password" class="auth-input" placeholder="Enter password" autocomplete="current-password">
            </div>
          </div>

          <p id="signin-error" class="auth-error hidden"></p>

          <button id="signin-submit" class="auth-submit">Sign In</button>

          <p class="auth-switch">
            New here? <button id="show-signup" class="auth-switch-btn">Create account</button>
          </p>
        </div>

        <!-- Sign Up Form -->
        <div id="auth-signup" class="auth-form hidden">
          <div class="auth-fields">
            <div class="auth-field">
              <label class="auth-label" for="signup-email">Email</label>
              <input type="email" id="signup-email" class="auth-input" placeholder="your@email.com" autocomplete="email">
            </div>
            <div class="auth-field">
              <label class="auth-label" for="signup-password">Password</label>
              <input type="password" id="signup-password" class="auth-input" placeholder="Min 6 characters" autocomplete="new-password">
            </div>
            <div class="auth-field">
              <label class="auth-label" for="signup-confirm">Confirm Password</label>
              <input type="password" id="signup-confirm" class="auth-input" placeholder="Confirm password" autocomplete="new-password">
            </div>
          </div>

          <p id="signup-error" class="auth-error hidden"></p>

          <button id="signup-submit" class="auth-submit">Begin</button>

          <p class="auth-switch">
            Have an account? <button id="show-signin" class="auth-switch-btn">Sign in</button>
          </p>
        </div>
      </div>
    </div>

    <!-- Digest Modal -->
    <div id="digest-modal" class="modal hidden">
      <div class="modal-content">
        <button class="modal-close" onclick="Digest.closeDigest()">‚úï</button>
        <div id="digest-content">
          <!-- Populated by JS -->
        </div>
      </div>
    </div>

    <!-- Meeting Debrief Modal (Phase 14) -->
    <div id="meeting-modal" class="modal hidden">
      <div class="modal-content meeting-modal-content">
        <button class="modal-close" id="meeting-modal-close" aria-label="Close">‚úï</button>
        <h2 class="meeting-modal-title">Meeting Debrief</h2>

        <div class="meeting-form">
          <div class="meeting-field">
            <label class="meeting-label" for="meeting-attendees-input">Who was there?</label>
            <div class="meeting-attendees">
              <input type="text" id="meeting-attendees-input" class="meeting-input" placeholder="Add people...">
              <div id="meeting-attendees-list" class="meeting-attendees-chips"></div>
              <div id="meeting-attendees-suggestions" class="meeting-suggestions hidden"></div>
            </div>
          </div>

          <div class="meeting-field">
            <label class="meeting-label" for="meeting-content">What happened?</label>
            <div class="meeting-capture-row">
              <button id="meeting-voice-btn" class="meeting-voice-btn" aria-label="Voice input">
                <span class="mic-icon">üé§</span>
                <div class="stop-icon"></div>
              </button>
              <textarea id="meeting-content" class="meeting-textarea" placeholder="Tap mic to speak or type here..." rows="4"></textarea>
            </div>
            <p id="meeting-transcript-display" class="meeting-transcript-display"></p>
          </div>

          <button id="meeting-save-btn" class="meeting-save-btn">Save Meeting</button>
        </div>
      </div>
    </div>

    <!-- PHASE 16 - T1: Meeting Capture Modal -->
    <div id="meeting-capture-modal" class="meeting-capture-modal hidden">
      <div class="meeting-capture-modal-content">
        <div class="meeting-capture-modal-header">
          <h2 class="meeting-capture-modal-title">Meeting Notes</h2>
          <button class="meeting-capture-modal-close" id="meeting-capture-close" aria-label="Close">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </div>
        <div id="meeting-capture-container">
          <!-- MeetingCapture component renders here -->
        </div>
      </div>
    </div>

    <!-- Decision Mode Modal (Phase 14) -->
    <div id="decision-modal" class="modal hidden">
      <div class="modal-content decision-modal-content">
        <button class="modal-close" id="decision-modal-close" aria-label="Close">‚úï</button>
        <h2 class="decision-modal-title">Thinking Through</h2>

        <div class="decision-form">
          <div class="decision-field">
            <label class="decision-label" for="decision-topic">What are you deciding?</label>
            <input type="text" id="decision-topic" class="decision-input" placeholder="e.g., Whether to push the launch">
          </div>

          <div class="decision-field">
            <label class="decision-label" for="decision-content">What's on your mind?</label>
            <div class="decision-capture-row">
              <button id="decision-voice-btn" class="decision-voice-btn" aria-label="Voice input">
                <span class="mic-icon">üé§</span>
                <div class="stop-icon"></div>
              </button>
              <textarea id="decision-content" class="decision-textarea" placeholder="Tap mic to speak or type here..." rows="4"></textarea>
            </div>
            <p id="decision-transcript-display" class="decision-transcript-display"></p>
          </div>

          <button id="decision-save-btn" class="decision-save-btn">Save</button>
        </div>
      </div>
    </div>

    <!-- Bottom Navigation - Phase 15.1: 3 tabs (NOTES, YOU, MIRROR) -->
    <nav class="nav nav-three-tabs">
      <button class="nav-tab active" data-screen="notes">
        <span class="nav-label">NOTES</span>
      </button>
      <button class="nav-tab" data-screen="you">
        <span class="nav-label">YOU</span>
      </button>
      <button class="nav-tab" data-screen="mirror">
        <span class="nav-label">MIRROR</span>
      </button>
    </nav>
  </div>

  <!-- Supabase Client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Encryption (T1 - Zero-Knowledge Foundation) -->
  <script src="js/encryption.js?v=100"></script>
  <script src="js/key-manager.js?v=100"></script>

  <!-- Scripts (v6.0.6 cache bust) -->
  <script src="js/loading-messages.js?v=800"></script>
  <script src="js/notes-cache.js?v=800"></script>
  <script src="js/db.js?v=700"></script>
  <script src="js/notes-manager.js?v=860"></script>
  <script src="js/classifier.js?v=700"></script>
  <script src="js/extractor.js?v=802"></script>
  <script src="js/refiner.js?v=700"></script>
  <script src="js/app.js?v=700"></script>
  <script src="js/ui.js?v=824"></script>
  <script src="js/ui-chat.js?v=790"></script>
  <script src="js/ui-camera.js?v=790"></script>
  <script src="js/ui-entities.js?v=790"></script>
  <script src="js/voice.js?v=700"></script>
  <script src="js/camera.js?v=700"></script>
  <script src="js/digest.js?v=700"></script>
  <script src="js/toast.js?v=860"></script>
  <script src="js/sync.js?v=860"></script>
  <script src="js/auth.js?v=700"></script>
  <script src="js/data-capture.js?v=100"></script>  <!-- T4: Data capture for personalization -->
  <script src="js/knowledge-graph.js?v=101"></script>  <!-- Phase 19: Unified knowledge architecture -->
  <script src="js/pin.js?v=700"></script>
  <script src="js/memory-decrypt.js?v=100"></script>
  <script src="js/entity-memory.js?v=700"></script>
  <script src="js/user-profile.js?v=700"></script>
  <script src="js/twin-profile.js?v=821"></script>
  <script src="js/entity-extractor.js?v=700"></script>
  <script src="js/belief-extractor.js?v=700"></script>
  <script src="js/pattern-detector.js?v=700"></script>
  <script src="js/twin-engine.js?v=700"></script>
  <script src="js/twin-ui.js?v=802"></script>
  <!-- PHASE 15 - T2 -->
  <script src="js/state-of-you-ui.js?v=850"></script>
  <script src="js/whisper-ui.js?v=850"></script>
  <script src="js/memory-moments-ui.js?v=850"></script>
  <!-- PHASE 16 - T1: Enhancement System -->
  <script src="js/enhance-display.js?v=861"></script>
  <script src="js/voice-input.js?v=861"></script>
  <script src="js/attendee-suggest.js?v=861"></script>
  <script src="js/meeting-capture.js?v=862"></script>
  <script src="js/auto-enhance.js?v=861"></script>
  <script src="js/ambient-recorder.js?v=861"></script>
  <script src="js/quality-learning.js?v=700"></script>
  <script src="js/analyzer.js?v=700"></script>
  <script src="js/analysis-validator.js?v=700"></script>
  <script src="js/tier-detector.js?v=700"></script>
  <script src="js/output-generator.js?v=700"></script>
  <script src="js/feedback.js?v=700"></script>
  <script src="js/decision-tracker.js?v=700"></script>
  <script src="js/actions-ui.js?v=700"></script>
  <script src="js/work-ui.js?v=822"></script>
  <script src="js/meetings-tab.js?v=900"></script>
  <script src="js/you-ui.js?v=901"></script>
  <script src="js/follow-up.js?v=700"></script>
  <script src="js/nudge-tracker.js?v=700"></script>
  <script src="js/onboarding.js?v=792"></script>
  <script src="js/ui-profile.js?v=701"></script>
  <script src="js/entities.js?v=700"></script>
  <script src="js/embeddings.js?v=770"></script>
  <script src="js/context.js?v=700"></script>
  <script src="js/settings.js?v=700"></script>
  <script src="js/settings-export.js?v=922"></script>  <!-- EXPORT - T3 -->
  <script src="js/privacy-controls.js?v=100"></script>  <!-- PRIVACY - T3 Sprint 2 -->
  <script src="js/knowledge-pulse.js?v=800"></script>
  <script src="js/entity-cards.js?v=800"></script>
  <script src="js/signal-tracker.js?v=800"></script>
  <script src="js/analytics.js?v=920"></script>
  <script src="js/pattern-verification.js?v=800"></script>
  <script src="js/mirror.js?v=801"></script>
  <script>
    // Environment variables - loaded from API
    window.ENV = {
      SUPABASE_URL: '',
      SUPABASE_ANON_KEY: ''
    };

    // SERVICE WORKER DISABLED - caching issues blocking beta
    // Will re-enable after beta launch with proper caching strategy
    // v5.2.0 - No caching, always fresh from server

    // Unregister ALL existing service workers and clear caches
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(registrations => {
        registrations.forEach(reg => {
          reg.unregister();
          console.log('[App] Unregistered service worker');
        });
      });
    }

    // Clear any existing caches
    if ('caches' in window) {
      caches.keys().then(names => {
        names.forEach(name => {
          caches.delete(name);
          console.log('[App] Deleted cache:', name);
        });
      });
    }

    console.log('[App] Version: 9.1.0 - Phase 15.1 Three-Tab Restructure');

    // Main initialization - runs immediately
    (async function init() {
      // STEP 1: Fetch environment FIRST (blocking)
      console.log('Loading environment...');
      try {
        const response = await fetch('/api/env');
        if (response.ok) {
          const env = await response.json();
          window.ENV.SUPABASE_URL = env.SUPABASE_URL || '';
          window.ENV.SUPABASE_ANON_KEY = env.SUPABASE_ANON_KEY || '';
          console.log('Environment loaded:', window.ENV.SUPABASE_URL ? 'Supabase configured' : 'Supabase not configured');
        }
      } catch (error) {
        console.warn('Could not load environment:', error.message);
      }

      // STEP 2: Wait for DOM if not ready
      if (document.readyState === 'loading') {
        await new Promise(resolve => document.addEventListener('DOMContentLoaded', resolve));
      }

      // STEP 3: Setup Auth authenticated handler
      // OPTIMIZED Phase 14.3: Instant UI, lazy TWIN, background everything
      Auth.onAuthenticated = async function() {
        console.time('[PERF] Total app load');
        console.time('[PERF] Auth ‚Üí UI visible');
        const initStart = performance.now();
        console.log('[Init] onAuthenticated called');

        // PHASE 1: DB init + Onboarding check in PARALLEL
        console.time('[PERF] DB + Onboarding');
        const [_, shouldOnboard] = await Promise.all([
          App.init().catch(e => console.warn('[Init] App.init:', e.message)),
          (async () => {
            if (typeof Onboarding !== 'undefined') {
              return await Onboarding.shouldShow();
            }
            return false;
          })()
        ]);
        console.timeEnd('[PERF] DB + Onboarding');

        if (shouldOnboard) {
          console.log('[App] New user, starting onboarding');
          Onboarding.start();
          console.timeEnd('[PERF] Total app load');
          return;
        }

        // PHASE 2: Show UI IMMEDIATELY (cached notes render < 100ms)
        UI.init();
        console.timeEnd('[PERF] Auth ‚Üí UI visible');
        console.log('[Init] UI visible in', Math.round(performance.now() - initStart), 'ms');

        // PHASE 3: All other modules in background (DON'T await)
        // User can already interact with cached notes
        Promise.all([
          Voice.init(),
          Camera.init(),
          (typeof UserProfile !== 'undefined' ? UserProfile.init() : Promise.resolve()),
          (typeof TwinEngine !== 'undefined' ? TwinEngine.init() : Promise.resolve()),
        ]).then(() => {
          // After profile loads, init modules that depend on it
          TwinUI.init();  // Lazy loads heavy data when tab opened
          Feedback.init();
          ActionsUI.init();
          if (typeof WorkUI !== 'undefined') WorkUI.init();
          if (typeof YouUI !== 'undefined') YouUI.init();  // Phase 15.1: YOU tab
          console.log('[Init] All modules ready in', Math.round(performance.now() - initStart), 'ms');
        });

        // PHASE 4: Background sync (NON-BLOCKING)
        if (typeof Sync !== 'undefined' && Sync.isAuthenticated()) {
          Sync.syncNow().then(() => {
            console.log('[Init] Sync complete in', Math.round(performance.now() - initStart), 'ms');
          }).catch(e => console.warn('[Init] Sync:', e.message));
        }

        // PHASE 5: Deferred operations
        setTimeout(() => {
          if (typeof FollowUp !== 'undefined') FollowUp.checkPendingFollowUps();
        }, 3000);

        console.timeEnd('[PERF] Total app load');
      };

      // STEP 4: Check authentication
      const isAuthenticated = await Auth.init();

      if (isAuthenticated) {
        // Already logged in - start the app
        console.log('[Init] Already authenticated, starting app...');
        Auth.hideAuthScreen();
        await Auth.onAuthenticated();
      } else {
        // Show auth screen
        console.log('[Init] Not authenticated, showing auth screen...');
        Auth.showAuthScreen();
        Auth.attachAuthListeners();
      }
    })();
  </script>

  <!-- Phase 9.1: Feedback Toast -->
  <div class="feedback-toast" id="feedback-toast">
    <span class="feedback-toast__text"></span>
  </div>
</body>
</html>
